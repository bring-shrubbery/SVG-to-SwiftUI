var T=e=>(t,r)=>t[`node${e}`]===r[`node${e}`],b=T("Name"),C=T("Type"),g=T("Value");function M(e,t){if(e.attributes.length===0&&t.attributes.length===0)return[];let r=[],n=new Map,a=new Map;for(let s of e.attributes)n.set(s.name,s.value);for(let s of t.attributes){let o=n.get(s.name);s.value===o?n.delete(s.name):(typeof o<"u"&&n.delete(s.name),a.set(s.name,s.value))}for(let s of n.keys())r.push({type:5,name:s});for(let[s,o]of a.entries())r.push({type:4,name:s,value:o});return r}function N(e,t=!0){let r=`${e.localName}`;for(let{name:n,value:a}of e.attributes)t&&n.startsWith("data-")||(r+=`[${n}=${a}]`);return r+=e.innerHTML,r}function h(e){switch(e.tagName){case"BASE":case"TITLE":return e.localName;case"META":{if(e.hasAttribute("name"))return`meta[name="${e.getAttribute("name")}"]`;if(e.hasAttribute("property"))return`meta[name="${e.getAttribute("property")}"]`;break}case"LINK":{if(e.hasAttribute("rel")&&e.hasAttribute("href"))return`link[rel="${e.getAttribute("rel")}"][href="${e.getAttribute("href")}"]`;if(e.hasAttribute("href"))return`link[href="${e.getAttribute("href")}"]`;break}}return N(e)}function v(e){let[t,r=""]=e.split("?"),n=new URLSearchParams(r);return n.set("t",`${Date.now()}`),`${t}?${n}`}function u(e){if(e.nodeType===1&&e.hasAttribute("data-persist"))return e;if(e.nodeType===1&&e.localName==="script"){let t=document.createElement("script");for(let{name:r,value:n}of e.attributes)r==="src"&&(n=v(n)),t.setAttribute(r,n);return t.innerHTML=e.innerHTML,t}return e.cloneNode(!0)}function x(e,t){if(e.children.length===0&&t.children.length===0)return[];let r=[],n=new Map,a=new Map,s=new Map;for(let o of e.children)n.set(h(o),o);for(let o of t.children){let i=h(o),c=n.get(i);c?N(o,!1)!==N(c,!1)&&a.set(i,u(o)):s.set(i,u(o)),n.delete(i)}for(let o of e.childNodes){if(o.nodeType===1){let i=h(o);if(n.has(i)){r.push({type:1});continue}else if(a.has(i)){let c=a.get(i);r.push({type:3,attributes:M(o,c),children:I(o,c)});continue}}r.push(void 0)}for(let o of s.values())r.push({type:0,node:u(o)});return r}function I(e,t){let r=[],n=Math.max(e.childNodes.length,t.childNodes.length);for(let a=0;a<n;a++){let s=e.childNodes.item(a),o=t.childNodes.item(a);r[a]=p(s,o)}return r}function p(e,t){if(!e)return{type:0,node:u(t)};if(!t)return{type:1};if(C(e,t)){if(e.nodeType===3){let r=e.nodeValue,n=t.nodeValue;if(r.trim().length===0&&n.trim().length===0)return}if(e.nodeType===1){if(b(e,t)){let r=e.tagName==="HEAD"?x:I;return{type:3,attributes:M(e,t),children:r(e,t)}}return{type:2,node:u(t)}}else return e.nodeType===9?p(e.documentElement,t.documentElement):g(e,t)?void 0:{type:2,value:t.nodeValue}}return{type:2,node:u(t)}}function P(e,t){if(t.length!==0)for(let{type:r,name:n,value:a}of t)r===5?e.removeAttribute(n):r===4&&e.setAttribute(n,a)}async function O(e,t,r){if(!t)return;let n;switch(e.nodeType===9?(e=e.documentElement,n=e):r?n=r:n=e,t.type){case 0:{let{node:a}=t;e.appendChild(a);return}case 1:{if(!n)return;e.removeChild(n);return}case 2:{if(!n)return;let{node:a,value:s}=t;if(typeof s=="string"){n.nodeValue=s;return}n.replaceWith(a);return}case 3:{if(!n)return;let{attributes:a,children:s}=t;P(n,a);let o=Array.from(n.childNodes);await Promise.all(s.map((i,c)=>O(n,i,o[c])));return}}}function $(e,t){let r=p(e,t);return O(e,r)}export{$ as default,p as diff,O as patch};
